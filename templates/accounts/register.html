{% extends 'base.html' %}

{% block title %}Register{% endblock %}

{% block content %}
<div class="container d-flex align-items-center justify-content-center min-vh-100">
    <div class="card shadow-lg border-0 p-4 rounded-4" style="max-width: 500px; width: 100%;">
        <div class="text-center mb-4">
            <h2 class="fw-bold text-primary">üìù Create Your Account</h2>
            <p class="text-muted">Join Nova Judge and start solving!</p>
        </div>

        <form method="post" action="{% url 'register' %}" onsubmit="return validateForm()">
            {% csrf_token %}

            <div class="mb-3">
                <label for="username" class="form-label fw-semibold">Username</label>
                <input type="text" class="form-control form-control-lg rounded-3" id="username" name="username" required placeholder="Choose a username">
            </div>

            <div class="mb-3">
                <label for="email" class="form-label fw-semibold">Email</label>
                <input type="email" class="form-control form-control-lg rounded-3" id="email" name="email" required placeholder="Your email address">
            </div>

            <div class="mb-3">
                <label for="password1" class="form-label fw-semibold">Password</label>
                <input type="password" class="form-control form-control-lg rounded-3" id="password1" name="password1" required placeholder="Create a password" oninput="checkStrength()">
                <div id="strength-text" class="form-text mt-1"></div>
            </div>

            <div class="mb-3">
                <label for="password2" class="form-label fw-semibold">Confirm Password</label>
                <input type="password" class="form-control form-control-lg rounded-3" id="password2" name="password2" required placeholder="Re-enter your password">
            </div>

            <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="terms" required>
                <label class="form-check-label small text-muted" for="terms">
                    I agree to the <a href="/terms/" target="_blank">Terms & Conditions</a> and <a href="/privacy/" target="_blank">Privacy Policy</a>.
                </label>
            </div>

            {% if form.errors %}
                <div class="alert alert-danger rounded-3">
                    Please correct the errors below and try again.
                </div>
            {% endif %}

            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-success btn-lg rounded-3 shadow-sm">Register</button>
            </div>

            <div class="text-center mt-4">
                <p class="mb-0">Already have an account? 
                    <a href="{% url 'login' %}" class="text-decoration-none fw-semibold text-primary">Login here</a>
                </p>
            </div>
        </form>
    </div>
</div>

<script>
function checkStrength() {
    const pwd = document.getElementById("password1").value;
    const strengthText = document.getElementById("strength-text");

    let strength = 0;
    if (pwd.length >= 8) strength++;
    if (/[a-z]/.test(pwd)) strength++;
    if (/[A-Z]/.test(pwd)) strength++;
    if (/[0-9]/.test(pwd)) strength++;
    if (/[^a-zA-Z0-9]/.test(pwd)) strength++;

    let msg = "";
    let color = "";
    if (strength <= 2) {
        msg = "Weak password";
        color = "text-danger";
    } else if (strength === 3 || strength === 4) {
        msg = "Moderate password";
        color = "text-warning";
    } else {
        msg = "Strong password";
        color = "text-success";
    }

    strengthText.innerText = msg;
    strengthText.className = "form-text mt-1 " + color;
}

function validateForm() {
    const pwd1 = document.getElementById("password1").value;
    const pwd2 = document.getElementById("password2").value;
    if (pwd1 !== pwd2) {
        alert("Passwords do not match.");
        return false;
    }
    return true;
}
</script>
{% endblock %}
